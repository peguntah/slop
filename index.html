<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cook Buck Club</title>
    <style>
        :root {
            --sand: #f3eee4;
            --sand-dark: #d9cfbf;
            --sage: #9fb092;
            --deep-sage: #4c5b4f;
            --clay: #b47b59;
            --moss: #5f6f63;
            --text: #2d261f;
            --glass: rgba(255, 255, 255, 0.65);
            --stroke: rgba(255, 255, 255, 0.45);
            --horizon: #cbbda8;
            --horizon-rgb: 203, 189, 168;
        }

        * {
            box-sizing: border-box;
        }

        html,
        body {
            overflow-x: hidden;
            min-height: 100%;
        }

        html {
            background: var(--horizon);
        }

        html::after {
            content: "";
            position: fixed;
            left: 0;
            right: 0;
            bottom: -25vh;
            height: 35vh;
            pointer-events: none;
            background: linear-gradient(to bottom, rgba(var(--horizon-rgb), 0) 0%, rgba(var(--horizon-rgb), 0.65) 70%, rgba(var(--horizon-rgb), 1) 100%);
            z-index: 0;
        }

        body {
            margin: 0;
            min-height: 100vh;
            min-height: 100svh;
            font-family: "SF Pro Display", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            color: var(--text);
            background: radial-gradient(circle at top, #f9f6f1 0%, #e8e2d4 35%, #d9cfbf 70%, #cbbda8 100%);
            position: relative;
            padding: clamp(1.5rem, 4vw, 3rem) 0;
        }

        @supports (-webkit-touch-callout: none) {
            body {
                min-height: -webkit-fill-available;
            }
        }

        body::before,
        body::after {
            content: "";
            position: fixed;
            width: clamp(260px, 70vw, 520px);
            height: clamp(260px, 70vw, 520px);
            background: radial-gradient(circle, rgba(255, 255, 255, 0.65), rgba(255, 255, 255, 0));
            filter: blur(2px);
            z-index: 0;
            pointer-events: none;
        }

        body::before {
            top: clamp(1rem, 4vw, 2rem);
            left: clamp(-140px, -20vw, -60px);
        }

        body::after {
            bottom: clamp(-80px, -12vw, -40px);
            right: clamp(-140px, -18vw, -60px);
        }

        .page {
            position: relative;
            z-index: 1;
            display: flex;
            gap: 2rem;
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            padding: 0 clamp(1rem, 3vw, 2rem);
        }

        .glass {
            background: var(--glass);
            border-radius: 28px;
            border: 1px solid var(--stroke);
            box-shadow: 0 20px 50px rgba(46, 43, 37, 0.15);
            backdrop-filter: blur(22px) saturate(160%);
        }

        .sidebar {
            flex: 0 0 280px;
            padding: 0;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .sidebar-pane {
            width: 100%;
            border-radius: 28px;
        }

        .brand h2 {
            margin: 0.25rem 0;
            font-size: 1.9rem;
            letter-spacing: 0.03em;
        }

        .brand .label {
            text-transform: uppercase;
            font-size: 0.76rem;
            letter-spacing: 0.2em;
            color: var(--moss);
        }

        .sidebar-pane h3 {
            margin-top: 0;
            margin-bottom: 0.4rem;
        }

        .sidebar-pane p {
            margin-top: 0;
            margin-bottom: 0.75rem;
            color: rgba(45, 38, 31, 0.75);
        }

        .sidebar-links {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
        }

        .sidebar-links a {
            text-decoration: none;
            color: var(--deep-sage);
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.4rem 0.2rem;
        }

        .sidebar-links a::before {
            content: "";
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--clay);
        }

        .pill-link {
            display: inline-flex;
            padding: 0.55rem 1.2rem;
            border-radius: 999px;
            border: 1px solid rgba(91, 100, 91, 0.2);
            text-decoration: none;
            color: var(--moss);
            font-weight: 600;
            font-size: 0.9rem;
            background: rgba(255, 255, 255, 0.6);
        }

        .pill-link.subtle {
            background: transparent;
        }

        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .panel {
            padding: 2rem;
            max-width: 100%;
            box-sizing: border-box;
        }

        .hero {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 2rem;
        }

        .hero.hero-sidebar {
            grid-template-columns: 1fr;
            gap: 1.25rem;
            padding: 1.75rem;
            border: 1px solid rgba(45, 38, 31, 0.12);
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.12);
        }

        .eyebrow {
            text-transform: uppercase;
            letter-spacing: 0.2em;
            font-size: 0.75rem;
            color: var(--moss);
            margin-bottom: 0.8rem;
        }

        .hero h1 {
            margin: 0;
            font-size: clamp(2rem, 4vw, 3rem);
            line-height: 1.1;
        }

        .hero p {
            max-width: 36ch;
        }

        .cta-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1.25rem;
        }

        .btn {
            border: none;
            border-radius: 16px;
            padding: 0.65rem 1.3rem;
            font-weight: 600;
            font-size: 0.93rem;
            cursor: pointer;
            transition: transform 150ms ease, box-shadow 150ms ease;
        }

        .btn.primary {
            background: linear-gradient(120deg, var(--sage), var(--moss));
            color: white;
            box-shadow: 0 10px 25px rgba(95, 111, 99, 0.35);
        }

        .btn.ghost {
            background: rgba(255, 255, 255, 0.4);
            color: var(--deep-sage);
            border: 1px solid rgba(91, 100, 91, 0.3);
        }

        .btn:hover {
            transform: translateY(-1px);
        }

        .btn[disabled] {
            opacity: 0.45;
            cursor: not-allowed;
            box-shadow: none;
        }

        .hero-card {
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.85rem;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        .hero-card.brand,
        .hero-card.hero-info {
            border: 1px solid rgba(45, 38, 31, 0.15);
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.3);
        }

        .hero-card h3 {
            margin: 0;
        }

        .cookbook-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--deep-sage);
            margin: 0;
        }

        .cookbook-title a {
            color: inherit;
            text-decoration: none;
            border-bottom: 2px solid rgba(76, 91, 79, 0.3);
            padding-bottom: 0.1rem;
        }

        .cookbook-title a:hover {
            border-color: rgba(76, 91, 79, 0.6);
        }

        .cookbook-link {
            margin: 0.1rem 0 0;
            font-size: 0.95rem;
            color: rgba(45, 38, 31, 0.75);
        }

        .cookbook-link a {
            color: var(--deep-sage);
            font-weight: 600;
            text-decoration: none;
            border-bottom: 1px solid rgba(76, 91, 79, 0.3);
            padding-bottom: 0.05rem;
        }

        .cookbook-link a:hover {
            border-color: rgba(76, 91, 79, 0.6);
        }

        .hero-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }

        .hero-list li {
            display: flex;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.55);
            padding: 0.75rem 1rem;
            border-radius: 18px;
            border: 1px solid rgba(255, 255, 255, 0.4);
            font-size: 0.95rem;
        }

        .section-header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .forecast {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .forecast-card {
            padding: 1.5rem;
            border-radius: 22px;
            background: rgba(255, 255, 255, 0.55);
            border: 1px solid rgba(255, 255, 255, 0.35);
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .forecast-card h3 {
            margin: 0.35rem 0;
        }

        .forecast-card .eyebrow {
            margin: 0;
        }

        .forecast-meta {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .forecast-meta li {
            display: flex;
            justify-content: space-between;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .location-pill {
            align-self: flex-start;
            padding: 0.35rem 0.9rem;
            border-radius: 999px;
            background: rgba(76, 91, 79, 0.1);
            color: var(--deep-sage);
            font-weight: 600;
            border: 1px solid rgba(76, 91, 79, 0.25);
            font-size: 0.85rem;
        }

        .forecast-note {
            margin: 0;
            color: rgba(45, 38, 31, 0.75);
        }

        .featured-date-pill {
            display: inline-flex;
            flex-direction: column;
            padding: 0.9rem 1.2rem;
            border-radius: 18px;
            background: rgba(95, 111, 99, 0.12);
            border: 1px solid rgba(95, 111, 99, 0.25);
            gap: 0.2rem;
        }

        .featured-date-pill strong {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: rgba(45, 38, 31, 0.7);
        }

        .featured-date-pill span {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--deep-sage);
        }

        .override-note {
            display: inline-block;
            margin-top: 0.5rem;
            font-size: 0.85rem;
            color: rgba(180, 123, 89, 0.95);
        }

        .override-note.hidden {
            display: none;
        }

        .calendar-shell {
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            padding: 1.5rem;
            border-radius: 24px;
            background: rgba(255, 255, 255, 0.55);
            border: 1px solid rgba(255, 255, 255, 0.35);
            width: 100%;
            box-sizing: border-box;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .calendar-header-title {
            display: flex;
            flex-direction: column;
            text-align: center;
        }

        .calendar-header-title span {
            font-size: 0.75rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: rgba(45, 38, 31, 0.6);
        }

        .calendar-header-title h3 {
            margin: 0.2rem 0 0;
        }

        .calendar-nav {
            display: inline-flex;
            gap: 0.4rem;
            align-items: center;
        }
        .calendar-nav button {
            border: 1px solid rgba(95, 111, 99, 0.3);
            background: rgba(255, 255, 255, 0.8);
            border-radius: 16px;
            min-width: 42px;
            height: 42px;
            padding: 0 0.75rem;
            font-weight: 600;
            color: var(--deep-sage);
            cursor: pointer;
        }

        .month-select {
            border-radius: 16px;
            border: 1px solid rgba(95, 111, 99, 0.3);
            background: rgba(255, 255, 255, 0.85);
            font: inherit;
            padding: 0 1rem;
            color: var(--deep-sage);
            height: 42px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, minmax(40px, 1fr));
            gap: 0.35rem;
        }

        .calendar-day-name {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: rgba(45, 38, 31, 0.5);
            text-align: center;
        }

        .calendar-day {
            border: 1px solid rgba(95, 111, 99, 0.25);
            border-radius: 14px;
            min-height: 70px;
            background: rgba(255, 255, 255, 0.65);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: space-between;
            padding: 0.6rem 0.7rem;
            font-size: 1rem;
            color: var(--text);
            cursor: pointer;
        }

        .calendar-day .day-number {
            font-weight: 600;
        }

        .calendar-day .vote-tag {
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            border-radius: 999px;
            background: rgba(180, 123, 89, 0.12);
            color: var(--clay);
            border: 1px solid rgba(180, 123, 89, 0.25);
            display: inline-flex;
            align-items: center;
            gap: 0.2rem;
            margin-top: 0.35rem;
        }

        .vote-tag .vote-count-number {
            font-weight: 600;
        }

        .vote-tag .vote-count-label {
            text-transform: lowercase;
        }

        @media (max-width: 540px) {
            .vote-tag .vote-count-label {
                display: none;
            }
        }

        .calendar-day.suggested {
            background: rgba(159, 176, 146, 0.25);
            border-color: rgba(159, 176, 146, 0.6);
        }

        .calendar-day.manual {
            border-color: rgba(180, 123, 89, 0.55);
            background: rgba(180, 123, 89, 0.18);
        }

        .calendar-day.lead {
            background: rgba(180, 123, 89, 0.22);
            border-color: rgba(180, 123, 89, 0.6);
            box-shadow: inset 0 0 0 1px rgba(180, 123, 89, 0.4);
        }

        .calendar-day.selected {
            outline: 2px solid rgba(76, 91, 79, 0.55);
        }

        .calendar-day.empty {
            background: transparent;
            border: none;
            cursor: default;
            pointer-events: none;
        }

        .vote-buttons {
            display: flex;
            gap: 0.35rem;
        }

        .vote button {
            width: fit-content;
        }

        .undo-btn {
            padding: 0.35rem 0.9rem;
            border-radius: 16px;
            border: 1px solid rgba(91, 100, 91, 0.25);
            background: transparent;
            color: rgba(45, 38, 31, 0.7);
            font-weight: 500;
            cursor: pointer;
        }

        .event-cookbook {
            margin: 0.2rem 0 0;
            font-size: 0.9rem;
            color: rgba(45, 38, 31, 0.8);
        }

        form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        label span {
            font-size: 0.8rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            color: rgba(45, 38, 31, 0.6);
        }

        input,
        textarea,
        select {
            width: 100%;
            padding: 0.8rem 1rem;
            margin-top: 0.4rem;
            border-radius: 16px;
            border: 1px solid rgba(91, 100, 91, 0.25);
            background: rgba(255, 255, 255, 0.8);
            font: inherit;
            min-height: 52px;
        }

        .proposed-date-note {
            margin: 0 0 0.75rem;
            font-size: 0.8rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            color: rgba(45, 38, 31, 0.6);
        }

        textarea {
            min-height: 80px;
            resize: vertical;
        }

        form button[type="submit"] {
            justify-self: flex-start;
        }

        .suggestion-list {
            list-style: none;
            margin: 1.5rem 0 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        @media (max-width: 640px) {
            .calendar-header {
                flex-direction: column;
                gap: 0.75rem;
                align-items: stretch;
            }

            .calendar-header-title {
                text-align: left;
            }

            .calendar-nav {
                justify-content: space-between;
            }

            .calendar-grid {
                grid-template-columns: repeat(7, minmax(32px, 1fr));
                gap: 0.25rem;
            }

            .calendar-day {
                padding: 0.5rem;
                min-height: 60px;
            }

            .calendar-day .vote-tag {
                font-size: 0.65rem;
            }

            .calendar-shell {
                padding: 1.2rem;
            }

            .vote {
                align-items: flex-start;
                width: 100%;
            }

            .vote-count {
                width: 100%;
                text-align: left;
            }
        }

        @media (max-width: 720px) {
            body {
                padding: 2rem 0;
            }

            .page {
                width: 100%;
                padding: 0 1rem;
            }

            .sidebar {
                padding: 1.5rem 1.25rem;
                width: 100%;
            }

            .calendar-shell {
                padding: 1rem;
                margin: 0;
            }

            .panel {
                padding: 1.5rem;
            }

            .bookshelf-wrapper {
                margin: 1.25rem -1rem 0;
                width: calc(100% + 2rem);
            }

            .shelf-track {
                padding: 0.75rem 1rem 0.25rem;
            }
        }

        .availability-note {
            margin: 0.2rem 0 0.8rem;
            font-size: 0.9rem;
            color: rgba(45, 38, 31, 0.7);
        }

        .name-panel {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            margin-bottom: 1rem;
        }

        .name-form {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            max-width: 500px;
            align-items: flex-end;
            margin-top: 1rem;
        }

        .name-form label {
            flex: 1 1 240px;
        }

        .name-form input[type="text"] {
            height: 52px;
            padding: 0 1rem;
        }

        .name-form button {
            min-height: 52px;
            padding: 0 1.4rem;
            display: inline-flex;
            align-items: center;
        }

        .greeting-wrapper {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-top: 0.2rem;
        }

        .greeting-message {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
            color: var(--deep-sage);
        }

        .calendar-jump {
            border: 1px solid rgba(95, 111, 99, 0.3);
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.9);
            min-width: 130px;
            height: 42px;
            padding: 0 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--deep-sage);
            position: relative;
            cursor: pointer;
        }

        .calendar-jump input {
            position: absolute;
            inset: 0;
            opacity: 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
        }

        .planning-body {
            display: none;
            opacity: 0;
            transform: translateY(18px);
            pointer-events: none;
            transition: opacity 220ms ease, transform 220ms ease;
        }

        .planning-body.active {
            display: block;
            opacity: 1;
            transform: none;
            pointer-events: auto;
        }

        .hidden {
            display: none !important;
        }

        .calendar-tooltip {
            position: absolute;
            min-width: 220px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 18px;
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 10px 35px rgba(45, 38, 31, 0.25);
            padding: 1rem 1.2rem;
            z-index: 20;
        }

        .tooltip-day {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--deep-sage);
            margin-bottom: 0.4rem;
            border-bottom: 1px solid rgba(45, 38, 31, 0.1);
            padding-bottom: 0.4rem;
        }

        .tooltip-list {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
        }

        .tooltip-list li {
            font-size: 0.9rem;
            color: rgba(45, 38, 31, 0.85);
        }

        .tooltip-empty {
            font-size: 0.85rem;
            color: rgba(45, 38, 31, 0.6);
        }

        .tooltip-actions {
            margin-top: 0.8rem;
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .contribution-item {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 0.5rem;
            padding: 1rem 1.2rem;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.35);
            background: rgba(255, 255, 255, 0.6);
        }

        .contribution-item strong {
            font-size: 1rem;
        }

        .contribution-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.9rem;
            color: rgba(45, 38, 31, 0.7);
        }

        .contribution-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .contribution-controls {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .contribution-list {
            list-style: none;
            margin: 1rem 0 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .suggestion-item {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 1rem;
            padding: 1.25rem;
            border-radius: 22px;
            background: rgba(255, 255, 255, 0.55);
            border: 1px solid rgba(255, 255, 255, 0.35);
        }

        .suggestion-item h3 {
            margin: 0 0 0.25rem;
        }

        .suggestion-item p {
            margin: 0.1rem 0;
            color: rgba(45, 38, 31, 0.7);
        }

        .vote {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            justify-content: space-between;
        }

        .vote-count {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--clay);
        }

        .vote button {
            padding: 0.5rem 1rem;
            border-radius: 18px;
            border: 1px solid rgba(180, 123, 89, 0.4);
            background: rgba(180, 123, 89, 0.15);
            color: var(--clay);
            font-weight: 600;
            cursor: pointer;
        }

        .empty-state {
            text-align: center;
            padding: 1.5rem;
            color: rgba(45, 38, 31, 0.6);
        }

        .bookshelf-wrapper {
            position: relative;
            margin-top: 1.25rem;
            width: 100%;
        }

        .bookshelf {
            position: relative;
            border-radius: 28px;
            padding: 1.25rem 2rem 2rem;
            background: rgba(255, 255, 255, 0.55);
            border: 1px solid rgba(255, 255, 255, 0.35);
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            overflow: hidden;
        }

        .bookshelf::before,
        .bookshelf::after {
            content: "";
            position: absolute;
            top: 0;
            bottom: 0;
            width: 80px;
            pointer-events: none;
            z-index: 2;
        }

        .bookshelf::before {
            left: 0;
            background: linear-gradient(90deg, rgba(243, 238, 228, 0.9), rgba(243, 238, 228, 0));
        }

        .bookshelf::after {
            right: 0;
            background: linear-gradient(270deg, rgba(243, 238, 228, 0.9), rgba(243, 238, 228, 0));
        }

        .shelf-scroll {
            width: 100%;
            padding: 0 1.5rem;
            opacity: 0;
            transition: opacity 150ms ease;
        }

        .shelf-scroll-track {
            position: relative;
            height: 4px;
            border-radius: 999px;
            background: rgba(95, 111, 99, 0.2);
            overflow: hidden;
            cursor: pointer;
        }

        .shelf-scroll-track.disabled {
            opacity: 0.35;
            cursor: default;
        }

        .shelf-scroll-thumb {
            position: absolute;
            top: -4px;
            bottom: -4px;
            left: 0;
            min-width: 36px;
            border-radius: 999px;
            background: rgba(95, 111, 99, 0.65);
            box-shadow: 0 2px 8px rgba(45, 38, 31, 0.2);
            cursor: grab;
            transition: background 150ms ease;
        }

        .shelf-scroll-thumb:active {
            cursor: grabbing;
            background: rgba(95, 111, 99, 0.85);
        }

        .bookshelf:hover .shelf-scroll,
        .bookshelf:focus-within .shelf-scroll {
            opacity: 1;
        }

        .shelf-track {
            display: flex;
            gap: 0.75rem;
            align-items: flex-end;
            overflow-x: auto;
            overflow-y: visible;
            padding: 0.5rem 1.75rem 0.2rem;
            border-radius: 22px;
            background: rgba(255, 255, 255, 0.65);
            scrollbar-width: none;
        }

        .shelf-track::-webkit-scrollbar {
            display: none;
        }

        .book {
            width: 48px;
            height: 176px;
            border-radius: 8px;
            background: linear-gradient(160deg, rgba(95, 111, 99, 0.4), rgba(148, 128, 108, 0.55));
            border: 1px solid rgba(45, 38, 31, 0.15);
            box-shadow: inset 0 0 0 2px rgba(255, 255, 255, 0.25);
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            transform: perspective(600px) rotateY(-7deg);
            text-decoration: none;
        }

        .book span {
            writing-mode: vertical-rl;
            transform: rotate(180deg);
            text-align: center;
            font-size: 0.78rem;
            line-height: 1.8;
        }

        .book:nth-child(2n) {
            background: linear-gradient(150deg, rgba(107, 83, 90, 0.45), rgba(158, 122, 129, 0.55));
        }

        .book:nth-child(3n) {
            background: linear-gradient(150deg, rgba(78, 92, 86, 0.45), rgba(138, 163, 144, 0.55));
        }

        .book.placeholder {
            opacity: 0.25;
            filter: grayscale(0.1);
            border-style: dashed;
            pointer-events: none;
        }

        .shelf-base {
            position: absolute;
            left: 2.5rem;
            right: 2.5rem;
            bottom: 0.7rem;
            height: 15px;
            border-radius: 14px;
            background: linear-gradient(180deg, rgba(221, 210, 196, 0.9), rgba(189, 173, 154, 0.9));
            border: 1px solid rgba(187, 173, 156, 0.75);
            box-shadow:
                inset 0 1px 0 rgba(255, 255, 255, 0.85),
                0 10px 24px rgba(45, 38, 31, 0.18);
            pointer-events: none;
        }

        .shelf-note {
            margin: 1rem 0 0;
            text-align: center;
            font-size: 0.85rem;
            color: rgba(45, 38, 31, 0.65);
        }

        .event-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 1.5rem;
        }

        .event-card {
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .event-card header h3 {
            margin: 0.2rem 0;
        }

        .event-date {
            text-transform: uppercase;
            letter-spacing: 0.15em;
            font-size: 0.72rem;
            color: rgba(45, 38, 31, 0.6);
        }

        .menu-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }

        .menu-list li {
            padding: 0.75rem 1rem;
            border-radius: 18px;
            border: 1px solid rgba(255, 255, 255, 0.4);
            background: rgba(255, 255, 255, 0.55);
            display: flex;
            justify-content: space-between;
            gap: 0.75rem;
            font-size: 0.92rem;
        }

        .menu-list strong {
            font-size: 0.85rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            color: var(--moss);
        }

        .event-actions {
            display: flex;
            gap: 0.8rem;
            flex-wrap: wrap;
        }

        .upload {
            border-radius: 22px;
            padding: 1rem 1.25rem;
            border: 1px dashed rgba(95, 111, 99, 0.5);
            background: rgba(255, 255, 255, 0.4);
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
            cursor: pointer;
        }

        .upload input {
            display: none;
        }

        .upload-text {
            font-weight: 600;
        }

        .upload-note {
            color: rgba(45, 38, 31, 0.65);
            font-size: 0.85rem;
        }

        @media (max-width: 960px) {
            .page {
                flex-direction: column;
            }

            .sidebar {
                flex: 0 0 100%;
                width: 100%;
                max-width: none;
                padding: 0;
                align-self: stretch;
            }

            .sidebar-pane {
                width: 100%;
                padding: 2rem;
            }
        }

        @media (max-width: 620px) {
            form {
                grid-template-columns: 1fr;
            }

            .panel {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="page">
        <aside class="sidebar">
            <div class="sidebar-pane panel glass hero hero-sidebar">
                <div class="hero-card brand">
                    <p class="label">IT'S GIVING POTLUCK</p>
                    <h2>Cook Buck Club</h2>
                    <p>A loose excuse to hang out with family and close friends.</p>
                </div>
                <div class="hero-card hero-info">
                    <h2>What is it?</h2>
                    <p>Essentially a potluck, but focused around a different cook book each time.</p>
                    <p>Scroll down to use the party planner to pick your available dates.</p>
                </div>
            </div>
        </aside>

        <main>
            <section class="panel glass calendar" id="calendar">
                <div class="section-header">
                    <div>
                        <h2>Party Planning</h2>
                        <p>Enter your name and pick a date that works for you.</p>
                    </div>
                </div>
                <div class="name-panel">
                    <form id="name-form" class="name-form">
                        <label>
                            <span>Who are you?</span>
                            <input type="text" name="attendee" placeholder="e.g. Jamie" required>
                        </label>
                        <button class="btn primary" type="submit">Submit</button>
                    </form>
                    <div class="greeting-wrapper hidden" id="greeting-wrapper">
                        <p id="planner-greeting" class="greeting-message"></p>
                        <button class="btn ghost" type="button" id="edit-name">Edit name</button>
                    </div>
                </div>
                <div class="forecast">
                    <article class="forecast-card glass">
                        <p class="eyebrow">the next event...</p>
                        <h3>1st Cook Buck Club Gathering</h3>
                        <ul class="forecast-meta">
                            <li><strong>Tentative Date</strong><span id="featured-date-value">Date TBD</span></li>
                            <li><strong>Gathering time</strong><span>7:00 PM-ish</span></li>
                            <li><strong>City</strong><span>Woodburn, OR</span></li>
                        </ul>
                        <small class="override-note hidden" id="override-note">Manual override active</small>
                    </article>
                </div>
                <div id="planning-body" class="planning-body">
                    <p class="proposed-date-note">Proposed date</p>
                    <div class="calendar-shell">
                        <div class="calendar-header">
                            <div class="calendar-nav">
                                <button type="button" data-calendar-nav="prev">&#8249;</button>
                                <div class="calendar-jump" id="calendar-jump" role="button" tabindex="0">
                                    <span id="calendar-jump-label">Go to date</span>
                                    <input type="date" id="calendar-jump-input" aria-label="Jump to date">
                                </div>
                                <button type="button" data-calendar-nav="next">&#8250;</button>
                            </div>
                            <div class="calendar-header-title">
                                <span>Browse months</span>
                                <h3 id="calendar-month"></h3>
                            </div>
                        </div>
                        <div class="calendar-grid" id="calendar-grid"></div>
                    </div>
                    <ul id="suggestion-list" class="suggestion-list">
                        <li class="empty-state">Collecting suggestions...</li>
                    </ul>
                </div>
            </section>

            <section class="panel glass hero" id="top">
                <div class="hero-card glass" style="grid-column: 1 / -1;">
                    <p class="eyebrow">Featured cookbook</p>
                    <h1>Salt, Fat, Acid, Heat</h1>
                    <p class="cookbook-title">
                        <a href="https://www.amazon.com/s?k=salt+fat+acid+heat+cookbook&adgrpid=192017047408&hvadid=779670824312&hvdev=c&hvexpln=0&hvlocphy=9198937&hvnetw=g&hvocijid=1301253900372127260--&hvqmt=e&hvrand=1301253900372127260&hvtargid=kwd-325948234444&hydadcr=4853_13513634_29928&mcid=dd78c11b84853be7b4942ebf1c2a5e82&tag=googhydr-20&ref=pd_sl_5e9hsd7z4u_e" target="_blank" rel="noopener noreferrer">
                            Shop “Salt, Fat, Acid, Heat” on Amazon
                        </a>
                    </p>
                    <p class="cookbook-link">
                        or <a href="https://griersmusings.wordpress.com/wp-content/uploads/2020/06/salt-fat-acid-heat.pdf" target="_blank" rel="noopener noreferrer">view the full cookbook PDF</a>
                    </p>
                    <p>A loose excuse to hang out with family and close friends. Add what you want to cook below.</p>
                </div>
                <div class="panel glass" style="grid-column: 1 / -1;">
                    <div class="section-header">
                        <div>
                            <p class="eyebrow">menu</p>
                            <h2>Who's cooking what?</h2>
                        </div>
                    </div>
                    <form id="contribution-form" class="name-form hidden">
                        <label>
                            <span>Name</span>
                            <input type="text" id="contribution-name" placeholder="e.g. Jamie" required>
                        </label>
                        <label>
                            <span>Dish</span>
                            <input type="text" id="contribution-dish" placeholder="e.g. Herby citrus salad" required>
                        </label>
                        <label>
                            <span>Page #</span>
                            <input type="text" id="contribution-page" placeholder="e.g. 126" required>
                        </label>
                        <button class="btn primary" type="submit" id="contribution-submit">Save dish</button>
                        <button class="btn ghost hidden" type="button" id="contribution-cancel">Cancel edit</button>
                    </form>
                    <ul id="contributions-list" class="contribution-list"></ul>
                    <div class="contribution-controls">
                        <button class="btn primary" type="button" id="toggle-contribution-form">Add dish</button>
                        <button class="btn ghost" type="button" id="toggle-contribution-edit">Edit list</button>
                    </div>
                </div>
            </section>

            <section class="panel glass past-events" id="past-events">
                <div class="section-header">
                    <div>
                        <p class="eyebrow">looking back</p>
                        <h2>Past Gatherings</h2>
                        <p>Each gathering is saved as a "book." View the menu and see photos from the event.</p>
                    </div>
                </div>
                <div class="bookshelf-wrapper">
                    <div class="bookshelf">
                        <div class="shelf-scroll" aria-hidden="true">
                            <div class="shelf-scroll-track">
                                <div class="shelf-scroll-thumb"></div>
                            </div>
                        </div>
                        <div class="shelf-track" aria-live="polite">
                            <a class="book placeholder" href="#" aria-disabled="true"><span>Salt, Fat, Acid, Heat</span></a>
                        </div>
                        <span class="shelf-base" aria-hidden="true"></span>
                    </div>
                </div>
                <p class="shelf-note">Add your recap links above when they’re ready—the shelf scrolls automatically once spines are present.</p>
            </section>
        </main>
    </div>

                    <script>
        const suggestionList = document.getElementById("suggestion-list");
        const nameForm = document.getElementById("name-form");
        const greetingMessage = document.getElementById("planner-greeting");
        const greetingWrapper = document.getElementById("greeting-wrapper");
        const editNameButton = document.getElementById("edit-name");
        const planningBody = document.getElementById("planning-body");
        const featuredDateValue = document.getElementById("featured-date-value");
        const overrideNote = document.getElementById("override-note");
        const calendarGrid = document.getElementById("calendar-grid");
        const calendarMonthLabel = document.getElementById("calendar-month");
        const calendarJumpInput = document.getElementById("calendar-jump-input");
        const calendarJumpLabel = document.getElementById("calendar-jump-label");
        const calendarJump = document.getElementById("calendar-jump");
        const contributionsList = document.getElementById("contributions-list");
        const contributionForm = document.getElementById("contribution-form");
        const contributionName = document.getElementById("contribution-name");
        const contributionDish = document.getElementById("contribution-dish");
        const contributionPage = document.getElementById("contribution-page");
        const contributionSubmit = document.getElementById("contribution-submit");
        const contributionCancel = document.getElementById("contribution-cancel");
        const contributionFormToggle = document.getElementById("toggle-contribution-form");
        const contributionEditToggle = document.getElementById("toggle-contribution-edit");
        const shelfTrack = document.querySelector(".shelf-track");
        const shelfScrollTrack = document.querySelector(".shelf-scroll-track");
        const shelfScrollThumb = document.querySelector(".shelf-scroll-thumb");

        const suggestions = [];

        let suggestionId = suggestions.length;
        let contributions = [];
        let contributionCounter = 0;
        let editingContributionId = null;
        let contributionFormOpen = false;
        let contributionsEditing = false;
        let currentName = "";
        const manualOverrideDate = null; // Set to "YYYY-MM-DD" to pin a date manually.
        const currentMonth = new Date();
        currentMonth.setDate(1);
        const earliestMonth = new Date();
        earliestMonth.setDate(1);

        const calendarTooltip = document.createElement("div");
        calendarTooltip.id = "calendar-tooltip";
        calendarTooltip.className = "calendar-tooltip hidden";
        document.body.appendChild(calendarTooltip);
        let tooltipDate = null;
        let tooltipButton = null;

        const dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

        const parseDateString = (value) => {
            const [year, month, day] = value.split("-").map(Number);
            return new Date(year, month - 1, day);
        };

        const formatDate = (value, options = { weekday: "short", month: "short", day: "numeric" }) =>
            parseDateString(value).toLocaleDateString(undefined, options);

        const formatLongDate = (value) =>
            formatDate(value, { weekday: "long", month: "long", day: "numeric" });

        const pad = (value) => String(value).padStart(2, "0");
        const todayIso = (() => {
            const now = new Date();
            return `${now.getFullYear()}-${pad(now.getMonth() + 1)}-${pad(now.getDate())}`;
        })();
        calendarJumpInput.min = todayIso;

        const createSuggestionForDate = (iso) => {
            if (!iso) {
                return null;
            }

            if (!currentName) {
                alert("Add your name above the calendar first.");
                return null;
            }

            if (iso < todayIso) {
                alert("Please pick a date starting today or later.");
                return null;
            }

            if (suggestions.some((item) => item.date === iso)) {
                alert("That date is already on the board.");
                return null;
            }

            const suggestion = {
                id: ++suggestionId,
                date: iso,
                details: "",
                attendees: new Set()
            };

            addAttendee(suggestion, currentName);
            suggestions.push(suggestion);
            return suggestion;
        };

        const setCalendarJumpLabel = () => {
            if (calendarJumpInput.value) {
                const jumpDate = parseDateString(calendarJumpInput.value);
                calendarJumpLabel.textContent = jumpDate.toLocaleDateString(undefined, {
                    month: "short",
                    day: "numeric",
                    year: "numeric"
                });
            } else {
                calendarJumpLabel.textContent = "Go to date";
            }
        };

        setCalendarJumpLabel();

        const getMonthLabel = (date) => {
            const isCompact = window.innerWidth <= 520;
            return parseDateString(
                `${date.getFullYear()}-${pad(date.getMonth() + 1)}-01`
            ).toLocaleDateString(undefined, {
                month: isCompact ? "short" : "long",
                year: "numeric"
            });
        };

        const defaultContributions = [];

        const ensureAttendees = (item) => {
            if (!item.attendees) {
                item.attendees = new Set();
            }
            return item.attendees;
        };

        const addAttendee = (item, name) => {
            const trimmed = name.trim();
            if (!trimmed) {
                return false;
            }
            const attendees = ensureAttendees(item);
            const before = attendees.size;
            attendees.add(trimmed);
            return attendees.size > before;
        };

        const removeAttendee = (item, name) => {
            const trimmed = name.trim();
            if (!trimmed) {
                return false;
            }
            const attendees = ensureAttendees(item);
            return attendees.delete(trimmed);
        };

        const getScore = (item) => ensureAttendees(item).size;

        const getTopSuggestion = () => {
            if (!suggestions.length) {
                return null;
            }

            return [...suggestions]
                .sort((a, b) => {
                    const scoreDiff = getScore(b) - getScore(a);
                    if (scoreDiff !== 0) {
                        return scoreDiff;
                    }
                    return parseDateString(a.date) - parseDateString(b.date);
                })[0];
        };

        const updateFeaturedDate = () => {
            const leadDate = manualOverrideDate || (getTopSuggestion()?.date ?? null);
            if (leadDate) {
                featuredDateValue.textContent = formatLongDate(leadDate);
            } else {
                featuredDateValue.textContent = "Date TBD";
            }

            if (manualOverrideDate) {
                overrideNote.classList.remove("hidden");
            } else {
                overrideNote.classList.add("hidden");
            }
        };

        const renderSuggestions = () => {
            if (!suggestions.length) {
                suggestionList.innerHTML = '<li class="empty-state">Be the first to suggest a date!</li>';
                return;
            }

            const sorted = [...suggestions].sort((a, b) => {
                const scoreDiff = getScore(b) - getScore(a);
                if (scoreDiff !== 0) {
                    return scoreDiff;
                }
                return parseDateString(a.date) - parseDateString(b.date);
            });

            suggestionList.innerHTML = sorted
                .map((item) => {
                    const attendees = Array.from(ensureAttendees(item));
                    const count = attendees.length;
                    const countLabel = `${count} friend${count === 1 ? "" : "s"}`;

                    return `
                        <li class="suggestion-item" data-id="${item.id}">
                            <div class="suggestion-info">
                                <h3>${formatDate(item.date, { weekday: "short", month: "short", day: "numeric", year: "numeric" })}</h3>
                                <p>${countLabel}</p>
                            </div>
                            <div class="vote">
                                <span class="vote-count">${countLabel}</span>
                                <div class="vote-buttons">
                                    <button data-action="attend" type="button">I'm in</button>
                                    <button class="undo-btn" data-action="remove" type="button">Undo</button>
                                </div>
                            </div>
                        </li>
                    `;
                })
                .join("");
        };

        const buildSuggestionMap = () => {
            const map = new Map();
            suggestions.forEach((item) => {
                map.set(item.date, item);
            });
            return map;
        };

        const updateMonthLabel = () => {
            calendarMonthLabel.textContent = getMonthLabel(currentMonth);
        };

        const closeTooltip = () => {
            calendarTooltip.classList.add("hidden");
            tooltipDate = null;
            tooltipButton = null;
        };

        const positionTooltip = () => {
            if (!tooltipButton || calendarTooltip.classList.contains("hidden")) {
                return;
            }
            const rect = tooltipButton.getBoundingClientRect();
            const tooltipRect = calendarTooltip.getBoundingClientRect();
            const preferredTop = window.scrollY + rect.top - tooltipRect.height - 12;
            const belowTop = window.scrollY + rect.bottom + 12;
            const fitsAbove = preferredTop > window.scrollY + 20;
            const top = fitsAbove ? preferredTop : belowTop;
            const centerLeft = window.scrollX + rect.left + rect.width / 2 - tooltipRect.width / 2;
            const maxLeft = window.scrollX + document.documentElement.clientWidth - tooltipRect.width - 16;
            const left = Math.max(window.scrollX + 16, Math.min(centerLeft, maxLeft));
            calendarTooltip.style.top = `${top}px`;
            calendarTooltip.style.left = `${left}px`;
        };

        const showTooltip = (button, iso, suggestion) => {
            tooltipButton = button;
            tooltipDate = iso;
            const date = parseDateString(iso);
            const header = `<p class="tooltip-day">${date.getDate()} &middot; ${date.toLocaleDateString(undefined, { month: "short" })}</p>`;
            const isPast = iso < todayIso;
            let body = "";
            let actions = "";

            if (suggestion) {
                const attendees = Array.from(ensureAttendees(suggestion));
                const userHasVote = ensureAttendees(suggestion).has(currentName);
                if (attendees.length) {
                    body = `<ul class="tooltip-list">${attendees.map((name) => `<li>${name}</li>`).join("")}</ul>`;
                } else {
                    body = '<p class="tooltip-empty">No votes yet. Be the first.</p>';
                }

                const voteDisabled = userHasVote;
                const removeDisabled = !userHasVote;
                actions = `
                    <div class="tooltip-actions">
                        <button class="btn primary" data-tooltip-action="add" data-tooltip-date="${iso}" ${voteDisabled ? "disabled" : ""}>Vote this date</button>
                        <button class="btn ghost" data-tooltip-action="remove" data-tooltip-date="${iso}" ${removeDisabled ? "disabled" : ""}>Remove vote</button>
                    </div>
                `;
            } else {
                body = isPast
                    ? '<p class="tooltip-empty">This date has already passed.</p>'
                    : '<p class="tooltip-empty">No plan here yet. Want to suggest it?</p>';
                actions = `
                    <div class="tooltip-actions">
                        <button class="btn primary" data-tooltip-action="suggest" data-tooltip-date="${iso}" ${isPast ? "disabled" : ""}>Add Date</button>
                    </div>
                `;
            }

            calendarTooltip.innerHTML = header + body + actions;
            calendarTooltip.classList.remove("hidden");
            positionTooltip();
        };

        const renderCalendar = () => {
            closeTooltip();
            const workingDate = new Date(currentMonth);
            const year = workingDate.getFullYear();
            const month = workingDate.getMonth();

            updateMonthLabel();

            const startDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const suggestionMap = buildSuggestionMap();
            const leadDate = manualOverrideDate || (getTopSuggestion()?.date ?? null);

            const cells = dayNames.map((day) => `<div class="calendar-day-name">${day}</div>`);

            for (let i = 0; i < startDay; i += 1) {
                cells.push('<div class="calendar-day empty"></div>');
            }

            for (let day = 1; day <= daysInMonth; day += 1) {
                const iso = `${year}-${pad(month + 1)}-${pad(day)}`;
                const suggestion = suggestionMap.get(iso);
                const isManual = manualOverrideDate === iso;
                const isLead = !manualOverrideDate && leadDate === iso && suggestion;
                const classes = ["calendar-day"];
                if (suggestion) {
                    classes.push("suggested");
                }
                if (isManual) {
                    classes.push("manual");
                } else if (isLead) {
                    classes.push("lead");
                }

                const count = suggestion ? getScore(suggestion) : 0;
                const voteTag = count
                    ? `<span class="vote-tag"><span class="vote-count-number">${count}</span><span class="vote-count-label">${count === 1 ? "friend" : "friends"}</span></span>`
                    : "";

                cells.push(`
                    <button class="${classes.join(" ")}" data-date="${iso}" data-has-suggestion="${Boolean(suggestion)}" type="button">
                        <span class="day-number">${day}</span>
                        ${voteTag}
                    </button>
                `);
            }

            while (cells.length % 7 !== 0) {
                cells.push('<div class="calendar-day empty"></div>');
            }

            calendarGrid.innerHTML = cells.join("");
        };

        const refreshUI = () => {
            renderSuggestions();
            renderCalendar();
            updateFeaturedDate();
        };

        refreshUI();

        nameForm.addEventListener("submit", (event) => {
            event.preventDefault();
            const formData = new FormData(nameForm);
            const name = (formData.get("attendee") || "").trim();
            if (!name) {
                return;
            }
            currentName = name;
            nameForm.classList.add("hidden");
            greetingMessage.textContent = `Hi, ${name}. What date works best for you?`;
            greetingWrapper.classList.remove("hidden");
            editNameButton.classList.remove("hidden");
            planningBody.classList.add("active");
        });

        editNameButton.addEventListener("click", () => {
            nameForm.classList.remove("hidden");
            const input = nameForm.querySelector('input[name="attendee"]');
            input.value = currentName;
            input.focus();
            greetingWrapper.classList.add("hidden");
            editNameButton.classList.add("hidden");
        });

        suggestionList.addEventListener("click", (event) => {
            const action = event.target.dataset.action;
            if (!action) {
                return;
            }

            if (!currentName) {
                alert("Add your name above the calendar first.");
                return;
            }

            const parent = event.target.closest(".suggestion-item");
            const id = Number(parent?.dataset.id);
            const suggestion = suggestions.find((item) => item.id === id);
            if (!suggestion) {
                return;
            }

            if (action === "attend") {
                addAttendee(suggestion, currentName);
                refreshUI();
            }

            if (action === "remove") {
                removeAttendee(suggestion, currentName);
                refreshUI();
            }
        });

        const renderContributions = () => {
            if (!contributions.length) {
                contributionsList.innerHTML =
                    '<li class="contribution-item"><span>No dishes claimed yet. Add yours!</span></li>';
                return;
            }

            contributionsList.innerHTML = contributions
                .map(
                    (item) => `
                <li class="contribution-item" data-contribution-id="${item.id}">
                    <div>
                        <strong>${item.name}</strong>
                        <div class="contribution-meta">
                            <span>${item.dish}</span>
                            <span>p. ${item.page}</span>
                        </div>
                    </div>
                    <div class="contribution-actions">
                        ${
                            contributionsEditing
                                ? '<button class="btn ghost" type="button" data-contribution-action="edit">Edit</button>'
                                : ""
                        }
                    </div>
                </li>
            `
                )
                .join("");
        };

        const resetContributionForm = () => {
            editingContributionId = null;
            contributionForm.reset();
            contributionSubmit.textContent = "Save dish";
            contributionCancel.classList.add("hidden");
        };

        const loadContributions = async () => {
            try {
                const response = await fetch("cookbook-contributions.json");
                if (!response.ok) {
                    throw new Error("request failed");
                }
                const data = await response.json();
                contributions = Array.isArray(data) ? data : [...defaultContributions];
            } catch {
                contributions = [...defaultContributions];
            }
            contributionCounter = contributions.reduce((max, item) => Math.max(max, item.id), 0);
            renderContributions();
        };

        loadContributions();

        const toggleContributionForm = (forceClose = false) => {
            if (forceClose) {
                contributionForm.classList.add("hidden");
                contributionFormToggle.textContent = "Add dish";
                contributionFormOpen = false;
                return;
            }

            contributionFormOpen = !contributionFormOpen;
            contributionForm.classList.toggle("hidden", !contributionFormOpen);
            contributionFormToggle.textContent = contributionFormOpen ? "Cancel" : "Add dish";
            if (contributionFormOpen) {
                contributionName.focus();
            } else {
                resetContributionForm();
            }
        };

        const toggleContributionEditing = () => {
            contributionsEditing = !contributionsEditing;
            contributionEditToggle.textContent = contributionsEditing ? "Done editing" : "Edit list";
            if (!contributionsEditing && editingContributionId) {
                resetContributionForm();
                toggleContributionForm(true);
            }
            renderContributions();
        };

        contributionFormToggle.addEventListener("click", () => {
            toggleContributionForm();
        });

        contributionEditToggle.addEventListener("click", () => {
            toggleContributionEditing();
        });

        contributionForm.addEventListener("submit", (event) => {
            event.preventDefault();
            const name = contributionName.value.trim();
            const dish = contributionDish.value.trim();
            const page = contributionPage.value.trim();

            if (!name || !dish || !page) {
                return;
            }

            if (editingContributionId) {
                const target = contributions.find((item) => item.id === editingContributionId);
                if (target) {
                    target.name = name;
                    target.dish = dish;
                    target.page = page;
                }
            } else {
                contributions.push({
                    id: ++contributionCounter,
                    name,
                    dish,
                    page
                });
            }

            resetContributionForm();
            toggleContributionForm(true);
            renderContributions();
        });

        contributionCancel.addEventListener("click", () => {
            resetContributionForm();
            toggleContributionForm(true);
        });

        contributionsList.addEventListener("click", (event) => {
            const action = event.target.dataset.contributionAction;
            if (!action) {
                return;
            }
            if (!contributionsEditing) {
                return;
            }
            const parent = event.target.closest("[data-contribution-id]");
            const id = Number(parent?.dataset.contributionId);
            const target = contributions.find((item) => item.id === id);
            if (!target) {
                return;
            }
            if (action === "edit") {
                editingContributionId = id;
                contributionName.value = target.name;
                contributionDish.value = target.dish;
                contributionPage.value = target.page;
                contributionSubmit.textContent = "Save dish";
                contributionCancel.classList.remove("hidden");
                contributionForm.classList.remove("hidden");
                contributionFormToggle.textContent = "Cancel";
                contributionFormOpen = true;
                contributionName.focus();
            }
        });

        const updateShelfScroll = () => {
            if (!shelfTrack || !shelfScrollTrack || !shelfScrollThumb) {
                return;
            }
            const scrollableWidth = shelfTrack.scrollWidth;
            const visibleWidth = shelfTrack.clientWidth;
            const maxScroll = Math.max(0, scrollableWidth - visibleWidth);
            const trackWidth = shelfScrollTrack.clientWidth;
            const thumbWidth = maxScroll === 0 ? trackWidth : Math.max((visibleWidth / scrollableWidth) * trackWidth, 36);
            const thumbTravel = Math.max(trackWidth - thumbWidth, 0);
            const offset = maxScroll === 0 ? 0 : (shelfTrack.scrollLeft / maxScroll) * thumbTravel;

            shelfScrollThumb.style.width = `${thumbWidth}px`;
            shelfScrollThumb.style.transform = `translateX(${offset}px)`;
            shelfScrollTrack.classList.toggle("disabled", maxScroll === 0);
        };

        const scrollShelfToRatio = (ratio, smooth = true) => {
            if (!shelfTrack) return;
            const maxScroll = Math.max(0, shelfTrack.scrollWidth - shelfTrack.clientWidth);
            shelfTrack.scrollTo({
                left: ratio * maxScroll,
                behavior: smooth ? "smooth" : "auto"
            });
        };

        if (shelfTrack && shelfScrollTrack && shelfScrollThumb) {
            shelfTrack.addEventListener("scroll", updateShelfScroll);
            window.addEventListener("resize", updateShelfScroll);

            shelfScrollTrack.addEventListener("pointerdown", (event) => {
                if (shelfScrollTrack.classList.contains("disabled")) return;
                const rect = shelfScrollTrack.getBoundingClientRect();
                const ratio = Math.min(Math.max((event.clientX - rect.left) / rect.width, 0), 1);
                scrollShelfToRatio(ratio);
            });

            let draggingThumb = false;
            let thumbPointerId = null;
            let dragOffset = 0;

            shelfScrollThumb.addEventListener("pointerdown", (event) => {
                if (shelfScrollTrack.classList.contains("disabled")) return;
                draggingThumb = true;
                thumbPointerId = event.pointerId;
                dragOffset = event.clientX - shelfScrollThumb.getBoundingClientRect().left;
                shelfScrollThumb.setPointerCapture(thumbPointerId);
                event.preventDefault();
            });

            const pointerMove = (event) => {
                if (!draggingThumb) return;
                const rect = shelfScrollTrack.getBoundingClientRect();
                const thumbWidth = shelfScrollThumb.offsetWidth;
                const trackWidth = rect.width;
                const maxTravel = Math.max(trackWidth - thumbWidth, 0);
                let position = event.clientX - rect.left - dragOffset;
                position = Math.min(Math.max(position, 0), maxTravel);
                const ratio = maxTravel === 0 ? 0 : position / maxTravel;
                scrollShelfToRatio(ratio, false);
            };

            const pointerUp = () => {
                if (!draggingThumb) return;
                draggingThumb = false;
                if (thumbPointerId !== null) {
                    shelfScrollThumb.releasePointerCapture(thumbPointerId);
                }
                thumbPointerId = null;
            };

            shelfScrollThumb.addEventListener("pointermove", pointerMove);
            shelfScrollThumb.addEventListener("pointerup", pointerUp);
            shelfScrollThumb.addEventListener("pointercancel", pointerUp);

            updateShelfScroll();
        }

        calendarTooltip.addEventListener("click", (event) => {
            const action = event.target.dataset.tooltipAction;
            const iso = event.target.dataset.tooltipDate;
            if (!action || !iso) {
                return;
            }

            if (action === "suggest") {
                const created = createSuggestionForDate(iso);
                if (!created) {
                    return;
                }
                refreshUI();
                const newButton = calendarGrid.querySelector(`[data-date="${created.date}"]`);
                if (newButton) {
                    showTooltip(newButton, created.date, created);
                }
                return;
            }

            if (!currentName) {
                alert("Add your name above the calendar first.");
                return;
            }

            const suggestion = suggestions.find((item) => item.date === iso);
            if (!suggestion) {
                return;
            }

            if (action === "add") {
                addAttendee(suggestion, currentName);
            }

            if (action === "remove") {
                removeAttendee(suggestion, currentName);
            }

            refreshUI();
            const refreshedSuggestion = suggestions.find((item) => item.date === iso);
            const newButton = calendarGrid.querySelector(`[data-date="${iso}"]`);
            if (newButton && refreshedSuggestion) {
                showTooltip(newButton, iso, refreshedSuggestion);
            }
        });

        document.addEventListener("click", (event) => {
            const clickedButton = event.target.closest(".calendar-day");
            if (clickedButton && planningBody.classList.contains("active")) {
                const iso = clickedButton.dataset.date;
                const suggestion = suggestions.find((item) => item.date === iso);
                showTooltip(clickedButton, iso, suggestion);
                return;
            }

            if (calendarTooltip.contains(event.target)) {
                return;
            }

            if (tooltipButton && tooltipButton.contains(event.target)) {
                return;
            }

            closeTooltip();
        });

        document.addEventListener("keydown", (event) => {
            if (event.key === "Escape") {
                closeTooltip();
            }
        });

        document.querySelectorAll("[data-calendar-nav]").forEach((button) => {
            button.addEventListener("click", () => {
                const action = button.dataset.calendarNav;
                if (action === "prev") {
                    const testDate = new Date(currentMonth);
                    testDate.setMonth(testDate.getMonth() - 1, 1);
                    if (testDate >= earliestMonth) {
                        currentMonth.setMonth(currentMonth.getMonth() - 1);
                        currentMonth.setDate(1);
                    }
                } else if (action === "next") {
                    currentMonth.setMonth(currentMonth.getMonth() + 1);
                    currentMonth.setDate(1);
                } else if (action === "today") {
                    const today = new Date();
                    currentMonth.setFullYear(today.getFullYear(), today.getMonth(), 1);
                }
                renderCalendar();
            });
        });

        calendarJump.addEventListener("click", () => {
            if (calendarJumpInput.showPicker) {
                calendarJumpInput.showPicker();
            } else {
                calendarJumpInput.click();
            }
        });

        calendarJump.addEventListener("keydown", (event) => {
            if (event.key === "Enter" || event.key === " ") {
                event.preventDefault();
                if (calendarJumpInput.showPicker) {
                    calendarJumpInput.showPicker();
                } else {
                    calendarJumpInput.click();
                }
            }
        });

        calendarJumpInput.addEventListener("change", () => {
            const value = calendarJumpInput.value;
            if (!value) {
                setCalendarJumpLabel();
                return;
            }
            const [year, month, day] = value.split("-").map(Number);
            const target = new Date(year, month - 1, day || 1);
            if (target < earliestMonth) {
                return;
            }
            currentMonth.setFullYear(target.getFullYear(), target.getMonth(), 1);
            renderCalendar();
            setCalendarJumpLabel();
        });

        window.addEventListener("resize", () => {
            positionTooltip();
            updateMonthLabel();
            setCalendarJumpLabel();
        });
        window.addEventListener("scroll", positionTooltip);

        document.querySelectorAll(".upload input[type='file']").forEach((input) => {
            const note = input.closest(".upload")?.querySelector(".upload-note");
            const defaultText = note?.dataset.default;

            input.addEventListener("change", () => {
                if (!note) return;

                if (input.files.length) {
                    note.textContent = `${input.files.length} photo${input.files.length === 1 ? "" : "s"} ready to share`;
                } else if (defaultText) {
                    note.textContent = defaultText;
                }
            });
        });
    </script>
</body>
</html>













